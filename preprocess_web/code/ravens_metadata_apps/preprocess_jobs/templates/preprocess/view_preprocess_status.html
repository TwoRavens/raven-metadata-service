{% extends "base.html" %}

{% block extra_header %}
<script>

function check_preprocess_status() {
  let get_metdata_url = '{% url 'api_get_latest_metadata' job.id %}';
  $.getJSON(get_metdata_url, function (data) {

    if (data.success) {
      $('#id_job_alert_div').hide();
      //$('#div_metadata_as_json').show();
      //alert($('#div_metadata_as_json').height());
      $('#div_metadata_as_json').html('<pre>'
            + JSON.stringify(data.data, null, 4)
            + '</pre>');
    }else{
      //$('#div_metadata_as_json').hide();
      let current_time = new Date().toLocaleTimeString();
      $('#id_job_alert').html('Preprocess in progress (' + current_time + '');

      setTimeout(check_preprocess_status, 2000);
    }
  });
};

$(document).ready(function() {
  {% if job.state == "PREPROCESS_STARTED" %}
    check_preprocess_status();
  {% endif %}
});
</script>
{% endblock %}

{% block main_content %}

    {% include "preprocess/job_card.html" %}

    <div id="div_metadata_as_json"></div>
{% endblock %}
