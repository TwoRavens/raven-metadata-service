{%  extends "base.html" %}
{% load static %}
{% load humanize %}
{% block main_content %}

<div class="row">
  <div class="col-sm text-center">
    <h4>Summary Statistic Metadata</h4>
  </div>
</div>
    <hr>

    <div class="container">

    {% if job_page %}<b>{{ job_page.paginator.count }}</b> metadata file{{ job_page.paginator.count|pluralize }} found.
      {% if job_page.start_index == job_page.end_index %}
        Showing file number <b>{{ job_page.start_index }}</b>.
      {% else %}
        Showing files <b>{{ job_page.start_index }}</b> to <b>{{ job_page.end_index }}</b>.
      {% endif %}
    {% endif %}

    <table class="table table-hover">
    <thead class="thead-dark text-center">
    <tr>
      <th scope="col">#</th>
      <th scope="col">Name</th>
      <th scope="col">Preprocess<br />ID</th>
      {#<th scope="col">Status</th>#}
      <th scope="col">Created</th>
      <th scope="col">Size<br />(bytes)</th>
      <th scope="col">Action</th>
    </tr>
  </thead>
    <tbody>

  {% for r in job_page %}
    <tr>
      <td scope="row">({{ forloop.counter0|add:job_page.start_index }})


      </td>
      <td scope="row">
        {% if r.dv_info %}
          <img src="{% static "images/dataverse-icon.jpg" %}" alt="Dataverse Icon" width="20" height="30" />
        {% endif %}
        {{r.name}}
      </td>
      <td class="text-center">{{r.pk}}</td>
      {#<td>{{r.state }}</td>#}
      <td>{{r.created }}</td>
      {% if r.metadata_file %}
      <td>{{ r.metadata_file.size|filesizeformat }}</td>
      <td class="text-center">
        {% with metadata_obj=r %}
          {% include "preprocess/action_buttons.html" %}
        {% endwith %}

      </td>
      {% else %}
      <td>&#150; &#150;</td>
      <td class="text-center">
          {% if r.is_finished %}
            <!-- preprocess failed -->
            <span class="badge badge-danger">{{ r.state }}</span>
            {% if r.user_message %}
              <p class="text-left">{{ r.user_message }}</p>
            {% endif %}

          {% else %}
            <span class="badge badge-success">{{ r.state }}</span>
          {% endif %}
      </td>
      {% endif %}
    </tr>

  {% empty %}
    <tr>
      <td colspan="7">There are no preprocess job_page in the system.</td>
    </tr>
  {% endfor %}
    </tbody>
</table>
</div>

{% include "preprocess/list-pagination.html" %}

{% endblock %}
